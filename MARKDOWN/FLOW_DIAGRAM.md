# DEEP LEARNING INVOICE FORECAST SYSTEM - FLOW DIAGRAM

## Tá»”NG QUAN Há»† THá»NG

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INVOICE FORECAST PREDICTION SYSTEM                        â”‚
â”‚                         (Há»‡ thá»‘ng dá»± Ä‘oÃ¡n nháº­p hÃ ng)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## KIáº¾N TRÃšC 2 MODEL TÃCH BIá»†T

**âš ï¸ CHÃš Ã QUAN TRá»ŒNG:**

- Model 2 liÃªn quan trá»±c tiáº¿p Ä‘áº¿n Model 1 (sá»­ dá»¥ng output Y1 tá»« Model 1)
- NhÆ°ng 2 model phá»¥ trÃ¡ch 2 pháº§n viá»‡c KHÃC NHAU
- NÃªn pháº£i TÃCH RA Ä‘á»ƒ Ä‘á»™c láº­p vá» training vÃ  deployment

---

## FLOW CHÃNH

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATASET / INPUT DATA                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  1. DATASET (3 quÃ¡n):                                                    â”‚
â”‚     â€¢ Danh sÃ¡ch sáº£n pháº©m quÃ¡n SÆ¡n    (product_catalogs.json - "son")    â”‚
â”‚     â€¢ Danh sÃ¡ch sáº£n pháº©m quÃ¡n TÃ¹ng   (product_catalogs.json - "tung")   â”‚
â”‚     â€¢ HÃ³a Ä‘Æ¡n Ä‘iá»‡n tá»­ lá»‹ch sá»­ quÃ¡n TÃ¹ng (DATASET-tung1000.csv)          â”‚
â”‚                                                                           â”‚
â”‚  2. USER INPUT:                                                          â”‚
â”‚     â€¢ x1: HÃ³a Ä‘Æ¡n giáº¥y (Paper Invoice Images)                           â”‚
â”‚     â€¢ x2: HÃ³a Ä‘Æ¡n nháº­p hÃ ng hiá»‡n táº¡i (Current electronic invoices)      â”‚
â”‚     â€¢ x3: HÃ³a Ä‘Æ¡n nháº­p hÃ ng lá»‹ch sá»­ (Historical electronic invoices)    â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MODEL 1: CNN (IMAGE DETECTION)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  ğŸ¯ NHIá»†M Vá»¤: Chuyá»ƒn Ä‘á»•i hÃ³a Ä‘Æ¡n giáº¥y â†’ hÃ³a Ä‘Æ¡n Ä‘iá»‡n tá»­                â”‚
â”‚                                                                           â”‚
â”‚  INPUT:  x1 - HÃ³a Ä‘Æ¡n giáº¥y (Invoice Image)                              â”‚
â”‚          â””â”€ Format: PNG, JPG, PDF (scanned invoices)                    â”‚
â”‚                                                                           â”‚
â”‚  KIáº¾N TRÃšC CNN:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ 1. Image Preprocessing (224x224 RGB)                   â”‚              â”‚
â”‚  â”‚    â””â”€ Resize, normalize, augmentation                  â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ 2. MobileNetV2 (Transfer Learning)                     â”‚              â”‚
â”‚  â”‚    â””â”€ Feature extraction from invoice images           â”‚              â”‚
â”‚  â”‚    â””â”€ Frozen weights (ImageNet pretrained)             â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ 3. Custom Detection Head                               â”‚              â”‚
â”‚  â”‚    â”œâ”€ GlobalAveragePooling2D                           â”‚              â”‚
â”‚  â”‚    â”œâ”€ Dense(512, relu) â†’ Dropout(0.3)                  â”‚              â”‚
â”‚  â”‚    â”œâ”€ Dense(256, relu) â†’ Dropout(0.2)                  â”‚              â”‚
â”‚  â”‚    â”‚                                                    â”‚              â”‚
â”‚  â”‚    â”œâ”€ Output 1: Feature Vector (128 dim)               â”‚              â”‚
â”‚  â”‚    â”‚   â””â”€ Dense(128, relu) - Invoice features          â”‚              â”‚
â”‚  â”‚    â”‚                                                    â”‚              â”‚
â”‚  â”‚    â””â”€ Output 2: Invoice Type (3 classes)               â”‚              â”‚
â”‚  â”‚        â””â”€ Dense(3, softmax) - Store classification     â”‚              â”‚
â”‚  â”‚            (QuÃ¡n SÆ¡n / QuÃ¡n TÃ¹ng / QuÃ¡n HÃ²a)          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                           â”‚
â”‚  PROCESSING PIPELINE:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Step 1: CNN Detection                                  â”‚              â”‚
â”‚  â”‚         â””â”€ Extract features & classify store type      â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ Step 2: Text Region Extraction (OpenCV)                â”‚              â”‚
â”‚  â”‚         â”œâ”€ Grayscale conversion                        â”‚              â”‚
â”‚  â”‚         â”œâ”€ Otsu + Adaptive thresholding                â”‚              â”‚
â”‚  â”‚         â”œâ”€ Morphological operations                    â”‚              â”‚
â”‚  â”‚         â””â”€ Contour detection â†’ Text bounding boxes     â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ Step 3: OCR Simulation                                 â”‚              â”‚
â”‚  â”‚         â”œâ”€ Map store type â†’ Product catalog            â”‚              â”‚
â”‚  â”‚         â”œâ”€ Extract product lines from regions          â”‚              â”‚
â”‚  â”‚         â””â”€ Generate structured invoice data            â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                           â”‚
â”‚  OUTPUT: Y1 - HÃ³a Ä‘Æ¡n Ä‘iá»‡n tá»­ nháº­p hÃ ng (Structured Electronic Invoice) â”‚
â”‚          â””â”€ JSON format:                                                 â”‚
â”‚              {                                                            â”‚
â”‚                "invoice_id": "INV_12345",                                â”‚
â”‚                "store_name": "QuÃ¡n SÆ¡n",                                 â”‚
â”‚                "date": "2025-11-03T...",                                 â”‚
â”‚                "products": [                                             â”‚
â”‚                  {                                                        â”‚
â”‚                    "product_id": "SKU1001",                              â”‚
â”‚                    "product_name": "CÃ  phÃª Ä‘en",                         â”‚
â”‚                    "quantity": 25,                                       â”‚
â”‚                    "unit_price": 15000,                                  â”‚
â”‚                    "line_total": 375000                                  â”‚
â”‚                  },                                                       â”‚
â”‚                  ...                                                      â”‚
â”‚                ],                                                         â”‚
â”‚                "total_amount": 1250000,                                  â”‚
â”‚                "detection_confidence": 0.87                              â”‚
â”‚              }                                                            â”‚
â”‚                                                                           â”‚
â”‚  TRAINING:                                                               â”‚
â”‚  â”œâ”€ 70% Training data                                                    â”‚
â”‚  â”œâ”€ 10% Validation data                                                  â”‚
â”‚  â””â”€ 20% Test data                                                        â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ Y1 = x2 (trá»Ÿ thÃ nh input cho Model 2)
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INVOICE HISTORY DATABASE (In-Memory)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  LÆ°u trá»¯ lá»‹ch sá»­ hÃ³a Ä‘Æ¡n:                                               â”‚
â”‚  â€¢ Y1 (tá»« Model 1) = x2 (hÃ³a Ä‘Æ¡n nháº­p hÃ ng hiá»‡n táº¡i)                    â”‚
â”‚  â€¢ x3 (hÃ³a Ä‘Æ¡n nháº­p hÃ ng lá»‹ch sá»­ tá»« database/CSV)                       â”‚
â”‚  â€¢ Giá»›i háº¡n: 50 hÃ³a Ä‘Æ¡n gáº§n nháº¥t                                        â”‚
â”‚                                                                           â”‚
â”‚  Má»¥c Ä‘Ã­ch: Táº¡o time-series data cho LSTM                                â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ Combined: Y1 + x2 + x3
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MODEL 2: LSTM (QUANTITY FORECASTING)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  ğŸ¯ NHIá»†M Vá»¤: Dá»± Ä‘oÃ¡n sá»‘ lÆ°á»£ng nháº­p hÃ ng káº¿ tiáº¿p                        â”‚
â”‚                                                                           â”‚
â”‚  INPUT:  Y1 + x2 + x3 - Historical Invoice Data                         â”‚
â”‚          â””â”€ Time series of electronic invoices                           â”‚
â”‚          â””â”€ Features per invoice:                                        â”‚
â”‚              â€¢ Total quantity (tá»•ng sá»‘ lÆ°á»£ng sáº£n pháº©m)                  â”‚
â”‚              â€¢ Total amount (tá»•ng tiá»n)                                  â”‚
â”‚              â€¢ Number of products (sá»‘ lÆ°á»£ng máº·t hÃ ng)                    â”‚
â”‚              â€¢ Average price (giÃ¡ trung bÃ¬nh)                            â”‚
â”‚              â€¢ Time features (ngÃ y trong tuáº§n, thÃ¡ng)                    â”‚
â”‚                                                                           â”‚
â”‚  KIáº¾N TRÃšC LSTM:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ 1. Input Layer                                         â”‚              â”‚
â”‚  â”‚    â””â”€ Shape: (sequence_length=10, features=5)          â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ 2. Stacked LSTM Layers                                 â”‚              â”‚
â”‚  â”‚    â”œâ”€ LSTM(128) + Dropout(0.3) [returns sequences]     â”‚              â”‚
â”‚  â”‚    â””â”€ LSTM(64) + Dropout(0.2) [returns sequences]      â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ 3. Attention Mechanism                                 â”‚              â”‚
â”‚  â”‚    â”œâ”€ Dense(1, tanh) - Attention scores                â”‚              â”‚
â”‚  â”‚    â””â”€ Softmax - Attention weights                      â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ 4. Context Vector                                      â”‚              â”‚
â”‚  â”‚    â””â”€ Weighted sum of LSTM outputs                     â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ 5. Dense Layers                                        â”‚              â”‚
â”‚  â”‚    â”œâ”€ Dense(32, relu) + Dropout(0.2)                   â”‚              â”‚
â”‚  â”‚    â””â”€ Dense(1, linear) - Quantity prediction           â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                           â”‚
â”‚  PROCESSING PIPELINE:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Step 1: Data Preparation                               â”‚              â”‚
â”‚  â”‚         â”œâ”€ Extract features from invoices              â”‚              â”‚
â”‚  â”‚         â”œâ”€ Normalize/scale features                    â”‚              â”‚
â”‚  â”‚         â””â”€ Create sliding windows (10 timesteps)       â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ Step 2: LSTM Prediction                                â”‚              â”‚
â”‚  â”‚         â”œâ”€ Feed sequence through LSTM                  â”‚              â”‚
â”‚  â”‚         â”œâ”€ Apply attention mechanism                   â”‚              â”‚
â”‚  â”‚         â””â”€ Generate quantity forecast                  â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ Step 3: Trend Analysis                                 â”‚              â”‚
â”‚  â”‚         â”œâ”€ Linear regression on recent data            â”‚              â”‚
â”‚  â”‚         â””â”€ Classify: increasing/stable/decreasing      â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ Step 4: Product-wise Breakdown                         â”‚              â”‚
â”‚  â”‚         â””â”€ Forecast quantity per product category      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                           â”‚
â”‚  OUTPUT: Y2 TEXT - Dá»± Ä‘oÃ¡n sá»‘ lÆ°á»£ng Ä‘á»ƒ tiáº¿p                             â”‚
â”‚          â””â”€ JSON format:                                                 â”‚
â”‚              {                                                            â”‚
â”‚                "predicted_quantity": 245,                                â”‚
â”‚                "confidence": 0.89,                                       â”‚
â”‚                "trend": "increasing",                                    â”‚
â”‚                "trend_percentage": 12.5,                                 â”‚
â”‚                "product_breakdown": {                                    â”‚
â”‚                  "CÃ  phÃª Ä‘en": 85,                                       â”‚
â”‚                  "CÃ  phÃª sá»¯a": 65,                                       â”‚
â”‚                  "NÆ°á»›c cam": 45,                                         â”‚
â”‚                  ...                                                      â”‚
â”‚                },                                                         â”‚
â”‚                "prediction_details": {                                   â”‚
â”‚                  "method": "LSTM with Attention",                        â”‚
â”‚                  "historical_data_points": 50,                           â”‚
â”‚                  "sequence_length": 10                                   â”‚
â”‚                }                                                          â”‚
â”‚              }                                                            â”‚
â”‚                                                                           â”‚
â”‚  TRAINING:                                                               â”‚
â”‚  â”œâ”€ 70% Training data (from DATASET-tung1000.csv)                       â”‚
â”‚  â”œâ”€ 10% Validation data                                                  â”‚
â”‚  â””â”€ 20% Test data                                                        â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            FINAL OUTPUT / UI                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  User Interface hiá»ƒn thá»‹:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ MODEL 1 OUTPUT (Y1):                                   â”‚              â”‚
â”‚  â”‚ âœ… Processed 17 invoice(s)                             â”‚              â”‚
â”‚  â”‚ ğŸ“Š Total products extracted: 51                        â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ Extracted Products:                                    â”‚              â”‚
â”‚  â”‚ â€¢ CÃ  phÃª Ä‘en - 25 units @ 15,000 VND                   â”‚              â”‚
â”‚  â”‚ â€¢ CÃ  phÃª sá»¯a - 18 units @ 18,000 VND                   â”‚              â”‚
â”‚  â”‚ â€¢ NÆ°á»›c cam - 8 units @ 25,000 VND                      â”‚              â”‚
â”‚  â”‚ ...                                                     â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ Total: 1,250,000 VND                                   â”‚              â”‚
â”‚  â”‚ Confidence: 87.3%                                      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ MODEL 2 OUTPUT (Y2):                                   â”‚              â”‚
â”‚  â”‚ ğŸ”® Predicted Import Quantity: 245 products             â”‚              â”‚
â”‚  â”‚ ğŸ“ˆ Trend: Increasing (+12.5%)                          â”‚              â”‚
â”‚  â”‚ ğŸ¯ Confidence: 89.1%                                   â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ Product-wise Forecast:                                 â”‚              â”‚
â”‚  â”‚ â€¢ CÃ  phÃª Ä‘en: 85 units (recommend import)              â”‚              â”‚
â”‚  â”‚ â€¢ CÃ  phÃª sá»¯a: 65 units (recommend import)              â”‚              â”‚
â”‚  â”‚ â€¢ NÆ°á»›c cam: 45 units (moderate demand)                 â”‚              â”‚
â”‚  â”‚ ...                                                     â”‚              â”‚
â”‚  â”‚                                                         â”‚              â”‚
â”‚  â”‚ Based on 50 historical invoices                        â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Táº I SAO PHáº¢I TÃCH 2 MODEL?

### 1. **NHIá»†M Vá»¤ KHÃC NHAU**

```
MODEL 1 (CNN):                    MODEL 2 (LSTM):
â”œâ”€ Computer Vision                â”œâ”€ Time Series Forecasting
â”œâ”€ Image â†’ Text                   â”œâ”€ Historical Data â†’ Prediction
â”œâ”€ Spatial features               â”œâ”€ Temporal patterns
â””â”€ Feature extraction             â””â”€ Sequence learning
```

### 2. **INPUT/OUTPUT KHÃC NHAU**

```
MODEL 1:                          MODEL 2:
Input:  Images (PNG/JPG)          Input:  Structured JSON data
Output: Structured data (JSON)    Output: Quantity predictions (TEXT/Number)
```

### 3. **TRAINING PROCESS RIÃŠNG BIá»†T**

```
MODEL 1 Training:                 MODEL 2 Training:
â”œâ”€ Dataset: Invoice images        â”œâ”€ Dataset: DATASET-tung1000.csv
â”œâ”€ Labels: Product lists          â”œâ”€ Time-series sequences
â”œâ”€ Augmentation: Rotation,        â”œâ”€ Features: quantity, amount,
â”‚   brightness, noise             â”‚   time features
â””â”€ Transfer learning              â””â”€ Sequence modeling
    (MobileNetV2)
```

### 4. **DEPLOYMENT FLEXIBILITY**

```
CÃ³ thá»ƒ deploy riÃªng biá»‡t:
â”œâ”€ Model 1: Microservice cho OCR
â””â”€ Model 2: Microservice cho forecasting

Hoáº·c káº¿t há»£p:
â””â”€ Pipeline: Model 1 â†’ Model 2
```

### 5. **SCALABILITY & MAINTENANCE**

```
â”œâ”€ Update Model 1 â†’ khÃ´ng áº£nh hÆ°á»Ÿng logic Model 2
â”œâ”€ Update Model 2 â†’ khÃ´ng áº£nh hÆ°á»Ÿng detection Model 1
â””â”€ Test Ä‘á»™c láº­p tá»«ng model
```

---

## DATA FLOW CHI TIáº¾T

```
USER UPLOAD IMAGE
      â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                                         â”‚
      â–¼                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flask    â”‚                           â”‚   Static    â”‚
â”‚  Backend  â”‚                           â”‚   Frontend  â”‚
â”‚  (app.py) â”‚                           â”‚   (HTML/JS) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ POST /api/model1/detect
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  get_cnn_model()             â”‚
â”‚  (Lazy Loading)              â”‚
â”‚  â”œâ”€ Build if not exists      â”‚
â”‚  â””â”€ Return cached instance   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CNNInvoiceDetector          â”‚
â”‚  .predict_invoice_data()     â”‚
â”‚  â”œâ”€ detect_invoice()         â”‚
â”‚  â”œâ”€ extract_text_regions()   â”‚
â”‚  â””â”€ _extract_product_lines() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ Y1 (JSON)
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  invoice_history.append()    â”‚
â”‚  (Max 50 invoices)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ Return Y1 to frontend
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend displays:          â”‚
â”‚  â€¢ Extracted products        â”‚
â”‚  â€¢ Total amount              â”‚
â”‚  â€¢ Confidence score          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER CLICKS "PREDICT QUANTITY"
      â”‚
      â”‚ POST /api/model2/forecast
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  get_lstm_model()            â”‚
â”‚  (Lazy Loading)              â”‚
â”‚  â”œâ”€ Build if not exists      â”‚
â”‚  â””â”€ Return cached instance   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LSTMTextRecognizer          â”‚
â”‚  .predict_quantity()         â”‚
â”‚  â”œâ”€ _prepare_sequence()      â”‚
â”‚  â”œâ”€ _extract_features()      â”‚
â”‚  â”œâ”€ LSTM prediction          â”‚
â”‚  â””â”€ _analyze_trend()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ Y2 (Forecast JSON)
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend displays:          â”‚
â”‚  â€¢ Predicted quantity        â”‚
â”‚  â€¢ Trend analysis            â”‚
â”‚  â€¢ Product breakdown         â”‚
â”‚  â€¢ Confidence score          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Káº¾T LUáº¬N

âœ… **Model 1 vÃ  Model 2 hoáº¡t Ä‘á»™ng Ä‘á»™c láº­p nhÆ°ng cÃ³ liÃªn káº¿t:**

- Model 1 táº¡o ra Y1 (hÃ³a Ä‘Æ¡n Ä‘iá»‡n tá»­)
- Y1 trá»Ÿ thÃ nh input (x2) cho Model 2
- Má»—i model cÃ³ thá»ƒ train, test, deploy riÃªng
- Káº¿t há»£p táº¡o thÃ nh pipeline hoÃ n chá»‰nh

âœ… **Lá»£i Ã­ch cá»§a viá»‡c tÃ¡ch:**

- Dá»… maintain vÃ  debug
- CÃ³ thá»ƒ sá»­ dá»¥ng riÃªng láº» tá»«ng model
- Training Ä‘á»™c láº­p, khÃ´ng phá»¥ thuá»™c láº«n nhau
- Scalable vÃ  flexible cho production
